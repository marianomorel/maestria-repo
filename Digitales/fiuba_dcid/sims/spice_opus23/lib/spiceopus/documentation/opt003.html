<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
 <head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <meta name="description" content="SPICE OPUS -- A SPICE engine for OPtimization UtilitieS" />
  <meta name="keywords" content="analog circuit simulation, spice, opus, analog circuit optimization" />
  <meta name="author" content="Faculty of Electircal Engineering, Ljubljana, Slovenia / Template design: G. Wolfgang" />
  <link rel="stylesheet" type="text/css" media="screen,projection" href="./css/style_screen.css" />
  <link rel="stylesheet" type="text/css" media="print" href="./css/style_print.css" />
  <title>SPICE OPUS</title>
 </head>
 <body>
  <div class="bg-head">
   <div class="page-container-2">
    <!-- Navigation Level 1 -->
    <div class="nav1-container">
     <div class="nav1">
      <ul>
       <li>
        <a href="index.html">Home</a></li>
       <li>
        <a href="contact.html">Contact</a></li></ul></div></div>
		<a href="index.html"><div class="site-name"></div></a>
    <!-- Site slogan -->
	<div class="site-slogan-container">
	 <div class="site-slogan">
      <p class="readmore">&rsaquo;&rsaquo;&rsaquo;&nbsp;
       <a href="img/screen-pll.png">Screenshot</a></p>
      <p class="title">THE SLIDE RULE OF SILICON DESIGN</p>
      <p class="subtitle">Free Analog Circuit Simulation</p></div></div>
    <!-- Header banner -->
    <div class="img-header"></div>
    <!-- Navigation Level 2 -->
    <div class="nav2">
     <ul>
      <li><a href="index.html">About</a></li>
      <li><a href="license.html">License</a></li>
      <li><a href="release.html">Release</a></li>
      <li><a href="http://www.spiceopus.si/download/download.html">Download</a></li>
      <li><a href="documentation.html"class="selected">Documentation</a></li>
      <li><a href="links.html">Links</a></li></ul></div>
    <!-- Buffer after header -->
    <div class="buffer"></div>
    <!-- NAVIGATION -->
    <!-- Navigation Level 3 -->
    <div class="nav3">
     <ul>
      <li class="title">Menu</li>
      <li class="group">
       <a href="index.html">About</a></li>
      <li class="group">
       <a href="license.html">License</a></li>
      <li class="group">
       <a href="release.html">Release</a></li>
      <li class="group">
       <a href="http://www.spiceopus.si/download/download.html">Download</a></li>
      <li>
       <a href="http://www.spiceopus.si/download/downloadl.html">Linux</a></li>
      <li>
       <a href="http://www.spiceopus.si/download/downloadw.html">Windows</a></li>
      <li class="group">
       <a href="documentation.html"class="selected">Documentation</a></li>
      <li class="group">
       <a href="links.html">Links</a></li></ul></div>
    <!-- CONTENT -->
    <div class="content2">
     <!-- Page title -->
     <div class="content2-pagetitle">Triangle to Sine Waveform</div>
     <!-- Text container -->
     <div class="content2-container line-box">
      <div class="content2-container-1col">
       <p class="content-title-noshade-size3">The circuit</p>
       <div class="content-txtbox-noshade">
        <p>Let us now consider a circuit depicted below, which converts triangular signal waveform to sine waveform. We would like to set the resistances in the circuit so that the purest possible sine signal can be obtained at the output.</p>
        <p align="center">
         <img border="0" src="./imgopt/opt003-01.gif" /></p>
        <p>We will try to solve circuit analytically and calculate the values of the unknown resistors. The first problem is where to choose the break points. The relative error on one section is:</p>
        <p align="center">
         <img border="0" src="./imgopt/opt003-02.gif" /></p>
        <p>assuming
         <em>b</em> -
         <em>a</em> &lt;
         <em>
          <font face="symbol">p</font></em>/2.</p>
        <p>This result tells us that the best choice are equidistant break points. If we assume ideal diodes with cutin voltage ~ 0.5V and
         <em>r</em><sub>upi</sub> &lt;&lt;
         <em>r</em><sub>upoutj</sub>, than resistor values can be calculated (see teble below).</p>
        <p>Now we will optimise our circuit with the
         <em>optimize</em> command. Because of symmetry of the circuit we will observe only one half of the circuit in one quarter of a period. In this case we have 12 parameters to optimise
         <em>r</em><sub>up1</sub> ...
         <em>r</em><sub>up6</sub>,
         <em>r</em><sub>upout1</sub> ...
         <em>r</em><sub>upout6</sub>. The explicit constraints (see table below) are set around analytically calculated values. There are no implicit constraints. Let the cost function be defined as normalised square area between the real and ideal response:</p>
        <p align="center">
         <img border="0" src="./imgopt/opt003-03.gif" /></p>
        <p>It is a positive scalar and the circuit with ideal sine response would have its value zero.</p>
        <p>The initial point of optimisation method is approximately the center of the explicitly constrained parameter space.</p>
        <p align="center">Table 1: Resistor values (all values are rounded)
         <table class="table">
          <tr align="center">
           <td width="90"></td>
           <td width="90">analytic</td>
           <td width="130">explicit
            <br />constraint</td>
           <td width="90">initial</td>
           <td width="90">optimised</td></tr>
          <tr align="center">
           <td>
            <em>r</em><sub>upout1</sub></td>
           <td>17.0k<font face="symbol">W</font></td>
           <td>10 ÷ 20 k<font face="symbol">W</font></td>
           <td>15k<font face="symbol">W</font></td>
           <td>10.1k<font face="symbol">W</font></td></tr>
          <tr align="center">
           <td>
            <em>r</em><sub>upout2</sub></td>
           <td>87.6k<font face="symbol">W</font></td>
           <td>50 ÷ 150 k<font face="symbol">W</font></td>
           <td>100k<font face="symbol">W</font></td>
           <td>98.5k<font face="symbol">W</font></td></tr>
          <tr align="center">
           <td>
            <em>r</em><sub>upout3</sub></td>
           <td>216k<font face="symbol">W</font></td>
           <td>100 ÷ 300 k<font face="symbol">W</font></td>
           <td>200k<font face="symbol">W</font></td>
           <td>244k<font face="symbol">W</font></td></tr>
          <tr align="center">
           <td>
            <em>r</em><sub>upout4</sub></td>
           <td>432k<font face="symbol">W</font></td>
           <td>200 ÷ 600 k<font face="symbol">W</font></td>
           <td>400k<font face="symbol">W</font></td>
           <td>500k<font face="symbol">W</font></td></tr>
          <tr align="center">
           <td>
            <em>r</em><sub>upout5</sub></td>
           <td>828k<font face="symbol">W</font></td>
           <td>400 ÷ 1200 k<font face="symbol">W</font></td>
           <td>800k<font face="symbol">W</font></td>
           <td>1.07M<font face="symbol">W</font></td></tr>
          <tr align="center">
           <td>
            <em>r</em><sub>upout6</sub></td>
           <td>1.89M<font face="symbol">W</font></td>
           <td>1 ÷ 3 M<font face="symbol">W</font></td>
           <td>2M<font face="symbol">W</font></td>
           <td>2.62M<font face="symbol">W</font></td></tr>
          <tr align="center">
           <td>
            <em>r</em><sub>up1</sub></td>
           <td>4.57k<font face="symbol">W</font></td>
           <td>2.5 ÷ 7.5 k<font face="symbol">W</font></td>
           <td>5k<font face="symbol">W</font></td>
           <td>4.50k<font face="symbol">W</font></td></tr>
          <tr align="center">
           <td>
            <em>r</em><sub>up2</sub></td>
           <td>511<font face="symbol">W</font></td>
           <td>250 ÷ 750
            <font face="symbol">W</font></td>
           <td>500<font face="symbol">W</font></td>
           <td>578<font face="symbol">W</font></td></tr>
          <tr align="center">
           <td>
            <em>r</em><sub>up3</sub></td>
           <td>824<font face="symbol">W</font></td>
           <td>400 ÷ 1200
            <font face="symbol">W</font></td>
           <td>800<font face="symbol">W</font></td>
           <td>883<font face="symbol">W</font></td></tr>
          <tr align="center">
           <td>
            <em>r</em><sub>up4</sub></td>
           <td>1.09k<font face="symbol">W</font></td>
           <td>500 ÷ 1500
            <font face="symbol">W</font></td>
           <td>1k<font face="symbol">W</font></td>
           <td>1.13k<font face="symbol">W</font></td></tr>
          <tr align="center">
           <td>
            <em>r</em><sub>up5</sub></td>
           <td>1.31k<font face="symbol">W</font></td>
           <td>500 ÷ 1500
            <font face="symbol">W</font></td>
           <td>1k<font face="symbol">W</font></td>
           <td>1.18k<font face="symbol">W</font></td></tr>
          <tr align="center">
           <td>
            <em>r</em><sub>up6</sub></td>
           <td>1.46k<font face="symbol">W</font></td>
           <td>500 ÷ 1500
            <font face="symbol">W</font></td>
           <td>1k<font face="symbol">W</font></td>
           <td>1.22k<font face="symbol">W</font></td></tr></table></p>
        <p>We ran the optimisation with different optimisation methods from the same initial point. The parameters of all methods were set to their default values. So results (see table below) with the particular method could be improved by fine tuning method parameters. Anyway we can see that gradient methods have local character. They are quickly trapped in a local minimum, which can be just a consequence of numerical noise. Random and genetic algorithm search across whole parameter space but they need a lot of iterations to get satisfying results. Direct search methods performed better. Hooke-Jeeves's method was the best among direct search methods for this example. On the other hand Powell's method converged very fast and constrained simplex method gave slightly better result, but it did not manage to converge in 4000 iterations. Time needed for optimisation was measured on 200Mhz Pentium personal computer running Windows 95. Optimal parameter values obtained by Hooke-Jeeves's method are shown in the table above.</p>
        <p align="center">Table 2: Optimisation statistics
         <table class="table">
          <tr align="center">
           <td width="125"></td>
           <td width="125">number of iterations</td>
           <td width="125">cost value</td>
           <td width="125">time [s]</td></tr>
          <tr align="center">
           <td>initial point</td>
           <td></td>
           <td>4.05 10<sup>-3</sup></td>
           <td></td></tr>
          <tr align="center">
           <td>analitical point</td>
           <td></td>
           <td>3.26 10<sup>-5</sup></td>
           <td></td></tr>
          <tr align="center">
           <td>
            <em>steepest descent</em></td>
           <td>174</td>
           <td>1.72 10<sup>-5</sup></td>
           <td>4.07</td></tr>
          <tr align="center">
           <td>
            <em>newton</em></td>
           <td>480</td>
           <td>2.28 10<sup>-3</sup></td>
           <td>10.6</td></tr>
          <tr align="center">
           <td>
            <em>davidon_fletcher_powell</em></td>
           <td>103</td>
           <td>9.44 10<sup>-5</sup></td>
           <td>2.30</td></tr>
          <tr align="center">
           <td>
            <em>monte_carlo</em></td>
           <td>4000</td>
           <td>1.07 10<sup>-5</sup></td>
           <td>88.2</td></tr>
          <tr align="center">
           <td>
            <em>grid_search</em></td>
           <td>4097</td>
           <td>3.98 10<sup>-3</sup></td>
           <td>85.9</td></tr>
          <tr align="center">
           <td>
            <em>axis_search</em></td>
           <td>871</td>
           <td>8.47 10<sup>-6</sup></td>
           <td>19.6</td></tr>
          <tr align="center">
           <td>
            <em>powell</em></td>
           <td>362</td>
           <td>8.81 10<sup>-6</sup></td>
           <td>8.07</td></tr>
          <tr align="center">
           <td>
            <em>hooke_jeeves</em></td>
           <td>1625</td>
           <td>3.39 10<sup>-6</sup></td>
           <td>35.3</td></tr>
          <tr align="center">
           <td>
            <em>complex</em></td>
           <td>4001</td>
           <td>3.21 10<sup>-6</sup></td>
           <td>89.5</td></tr>
          <tr align="center">
           <td>
            <em>genetic</em></td>
           <td>2550</td>
           <td>1.03 10<sup>-5</sup></td>
           <td>60.6</td></tr></table></p>
        <p>To check if we improved analytically calculated circuit, we will take a closer look after the harmonic distortion of the output signal. We can see (table below) that optimisation method starting from initial circuit, which is worse than analytical circuit, gave better results than analytically calculated. The reason is in taking real diodes into account instead of ideal diodes in analytic circuit.</p>
        <p align="center">Table 3: Harmonic distortion (normalised magnitudes)
         <br />
         <table class="table">
          <tr align="center">
           <td width="125"></td>
           <td width="125">initial</td>
           <td width="125">analytic</td>
           <td width="125">optimised</td></tr>
          <tr align="center">
           <td>
            <em>f</em><sub>0</sub></td>
           <td>1</td>
           <td>1</td>
           <td>1</td></tr>
          <tr align="center">
           <td>3<em>f</em><sub>0</sub></td>
           <td>1.91 10<sup>-2</sup></td>
           <td>4.59 10<sup>-3</sup></td>
           <td>9.23 10<sup>-4</sup></td></tr>
          <tr align="center">
           <td>5<em>f</em><sub>0</sub></td>
           <td>2.01 10<sup>-3</sup></td>
           <td>2.87 10<sup>-3</sup></td>
           <td>5.44 10<sup>-4</sup></td></tr>
          <tr align="center">
           <td>7<em>f</em><sub>0</sub></td>
           <td>4.29 10<sup>-4</sup></td>
           <td>1.16 10<sup>-3</sup></td>
           <td>4.04 10<sup>-4</sup></td></tr>
          <tr align="center">
           <td>9<em>f</em><sub>0</sub></td>
           <td>1.17 10<sup>-3</sup></td>
           <td>1.27 10<sup>-3</sup></td>
           <td>1.19 10<sup>-3</sup></td></tr></table></p></div></div></div></div>
    <!-- FOOTER -->
    <div class="footer">
     <p>
      <strong>Copyright &copy; 2008 Faculty of Electrical Engineering, Ljubljana, Slovenia | All Rights Reserved</strong></p>
     <p>Page Design
      <a href="mailto:gw@actamail.com">G. Wolfgang</a> | Page content
      <a href="mailto:spice_developers@fides.fe.uni-lj.si">EDA Group</a></p></div></div></div>
  <script type="text/javascript">
   var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
   document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script>
  <script type="text/javascript">
   try
   {
     var pageTracker = _gat._getTracker("UA-8305434-3");
     pageTracker._trackPageview();
   } catch(err)
   {
   }
  </script></body></html>
