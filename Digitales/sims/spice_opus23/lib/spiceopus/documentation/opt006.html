<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
 <head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <meta name="description" content="SPICE OPUS -- A SPICE engine for OPtimization UtilitieS" />
  <meta name="keywords" content="analog circuit simulation, spice, opus, analog circuit optimization" />
  <meta name="author" content="Faculty of Electircal Engineering, Ljubljana, Slovenia / Template design: G. Wolfgang" />
  <link rel="stylesheet" type="text/css" media="screen,projection" href="./css/style_screen.css" />
  <link rel="stylesheet" type="text/css" media="print" href="./css/style_print.css" />
  <title>SPICE OPUS</title>
 </head>
 <body>
  <div class="bg-head">
   <div class="page-container-2">
    <!-- Navigation Level 1 -->
    <div class="nav1-container">
     <div class="nav1">
      <ul>
       <li>
        <a href="index.html">Home</a></li>
       <li>
        <a href="contact.html">Contact</a></li></ul></div></div>
		<a href="index.html"><div class="site-name"></div></a>
    <!-- Site slogan -->
	<div class="site-slogan-container">
	 <div class="site-slogan">
      <p class="readmore">&rsaquo;&rsaquo;&rsaquo;&nbsp;
       <a href="img/screen-pll.png">Screenshot</a></p>
      <p class="title">THE SLIDE RULE OF SILICON DESIGN</p>
      <p class="subtitle">Free Analog Circuit Simulation</p></div></div>
    <!-- Header banner -->
    <div class="img-header"></div>
    <!-- Navigation Level 2 -->
    <div class="nav2">
     <ul>
      <li><a href="index.html">About</a></li>
      <li><a href="license.html">License</a></li>
      <li><a href="release.html">Release</a></li>
      <li><a href="http://www.spiceopus.si/download/download.html">Download</a></li>
      <li><a href="documentation.html"class="selected">Documentation</a></li>
      <li><a href="links.html">Links</a></li></ul></div>
    <!-- Buffer after header -->
    <div class="buffer"></div>
    <!-- NAVIGATION -->
    <!-- Navigation Level 3 -->
    <div class="nav3">
     <ul>
      <li class="title">Menu</li>
      <li class="group">
       <a href="index.html">About</a></li>
      <li class="group">
       <a href="license.html">License</a></li>
      <li class="group">
       <a href="release.html">Release</a></li>
      <li class="group">
       <a href="http://www.spiceopus.si/download/download.html">Download</a></li>
      <li>
       <a href="http://www.spiceopus.si/download/downloadl.html">Linux</a></li>
      <li>
       <a href="http://www.spiceopus.si/download/downloadw.html">Windows</a></li>
      <li class="group">
       <a href="documentation.html"class="selected">Documentation</a></li>
      <li class="group">
       <a href="links.html">Links</a></li></ul></div>
    <!-- CONTENT -->
    <div class="content2">
     <!-- Page title -->
     <div class="content2-pagetitle">CMOS Operational Amplifier</div>
     <!-- Text container -->
     <div class="content2-container line-box">
      <div class="content2-container-1col">
       <p class="content-title-noshade-size3">The circuit</p>
       <div class="content-txtbox-noshade">
        <p>In this example the two-stage operational amplifier will be optimised by
         <em>optimize</em> command. The circuit is shown in figure below. It consists of two stages, the first of which is a differential stage with
         <em>p</em>-channel MOSFETs
         <em>m1</em> and
         <em>m2</em> and the current mirror
         <em>m3</em> and
         <em>m4</em> acting as an active load. The second stage is a simple CMOS inverter with
         <em>m6</em> as driver and
         <em>m5</em> acting as an active load. The output of the second stage is connected to its input by compensation capacitance
         <em>cc</em>. The configuration below is made in an
         <em>n</em>-well CMOS process.</p>
        <p align="center">
         <img border="0" src="./imgopt/opt006-01.gif" /></p>
        <p>The operational amplifier is biased by an independent current source
         <em>ib</em>. Transistors
         <em>m7</em> and
         <em>m8</em> have equal sizes. Thus, current
         <em>ib</em> also flows in the differential input stage. Transistor
         <em>m5</em> is expected to be much larger. Thus, the current in the second stage is expected to be much larger, as well.</p>
        <p>For small signals
         (<em>ac</em> analysis)
         <em>SPICE</em> replaces each MOS transistor with equivalent circuit below.</p>
        <p align="center">
         <img border="0" src="./imgopt/opt006-02.gif" /></p>
        <p>The analysis of the operational amplifier for small signals gives us quite complicated expression of transfer function
         <em>A<sub>u</sub></em>(<em>j<font face="symbol">w</font></em>) in
         <em>s</em> =
         <em>j<font face="symbol">w</font></em> plane. But we can obtain a simplified expression, which is valid only for relatively low frequencies.</p>
        <p align="center">
         <img border="0" src="./imgopt/opt006-03.gif" /></p>
        <p>We can see that the gain of the amplifier is approximately given by:</p>
        <p align="center">
         <img border="0" src="./imgopt/opt006-04.gif" /></p>
        <p>And the first (dominant) pole of the amplifier is at frequency:</p>
        <p align="center">
         <img border="0" src="./imgopt/opt006-05.gif" /></p>
        <p>In equations above the transistor transconductance
         <em>g<sub>m</sub></em> represents
         <em>g<sub>m</sub></em> +
         <em>g<sub>mb</sub></em> in
         <em>SPICE</em> small signal equivalent circuit, and
         <em>g<sub>0</sub></em> represents
         <em>g<sub>ds</sub></em> +
         <em>g<sub>bd</sub></em>.</p>
        <p>The optimisation parameters are channel lengths and widths off all transistors and compensation capacitance
         <em>cc</em>. This way we get 17 dimensional optimisation problem, but because the pairs of transistors
         <em>m1</em> and
         <em>m2</em>,
         <em>m3</em> and
         <em>m4</em>, and
         <em>m7</em> and
         <em>m8</em> are the same we have 11 dimensional optimisation problem. We can also determine the explicit constraints of optimisation parameters. For
         3<font face="symbol">m</font>m CMOS
         <em>n</em>-well technology we determine that:</p>
        <p align="center">
         4<font face="symbol">m</font>m &lt; channel width &lt;
         200<font face="symbol">m</font>m
         <br />
         4<font face="symbol">m</font>m &lt; channel length &lt;
         40<font face="symbol">m</font>m
         <br /> 1fF &lt;
         <em>cc</em> &lt; 5pF</p>
        <p>All transistors are supposed to operate in saturation region, thus all drain-source voltages have to be high enough
         <nobr>
          (<em>u<sub>ds</sub></em> &gt;
          <em>u<sub>dssat</sub></em>).</nobr> Also we want the transistors to operate in strong inversion, thus the gate-source voltages have to be larger than weak inversion limit
         <nobr>
          (<em>u<sub>gs</sub></em> &gt;
          <em>u<sub>t</sub></em> + cca. 200mV).</nobr> The appropriate operating point can be assured by two implicit constraints, which bound node voltages at nodes 1 and 3. For
         <em>vdd</em> = 2.5V and
         <em>vss</em> = -2.5V we can estimate that:</p>
        <p align="center">
         <em>v</em>(1) &gt; -1.38V
         <br />
         <em>v</em>(3) &gt; 1.23V</p>
        <p>We want to design the CMOS operational amplifier, which will have high gain, high bandwidth
         (<em>f</em><sub>-3dB</sub>), high phase margin, small current consumption, small nonlinearity, high peak-to-peak output voltage, small offset voltage and which will take small area. All those requirements are gathered in cost function, which is defined by:</p>
        <p align="center">
         <img border="0" src="./imgopt/opt006-06.gif" /></p>
        <p>We change
         <em>w</em> and
         <em>l</em> parameters of transistors
         <em>m1</em>,
         <em>m3</em>,
         <em>m5</em>,
         <em>m6</em> and
         <em>m7</em> in every iteration of optimisation process. The
         <em>w</em> and
         <em>l</em> parameters of transistors
         <em>m2</em>,
         <em>m4</em> and
         <em>m8</em> are changed as well and are equal to
         <em>w</em> and
         <em>l</em> parameters of transistors
         <em>m1</em>,
         <em>m3</em> and
         <em>m7</em>. We also have to change source and drain areas and perimeters of all transistors.
         <em>SPICE mos</em> model parameter
         <em>lambda</em> is changed as well, because it depends on channel length. For all details see file
         <em>cmos_operational_amplifier.cir</em>. The CMOS operational amplifier was optimised by Hooke-Jeeves's optimisation method.</p>
        <p>We can get values of
         <em>g<sub>m</sub></em> and
         <em>g<sub>0</sub></em> for all transistors by
         <em>show</em> command. For optimised circuit we get:
         <table>
          <tr>
           <td width="50"></td>
           <td width="400">
            <em>g<sub>m2</sub></em> =
            9.28<font face="symbol">m</font>S
            <br />
            <em>g<sub>m6</sub></em> =
            247<font face="symbol">m</font>S
            <br />
            <em>g<sub>02</sub></em> = 11.9nS
            <br />
            <em>g<sub>04</sub></em> = 22.3nS
            <br />
            <em>g<sub>05</sub></em> = 958nS
            <br />
            <em>g<sub>06</sub></em> =
            2.07<font face="symbol">m</font>S
            <br />
            <em>g<sub>l</sub></em> =
            10<font face="symbol">m</font>S
            <br />
            <em>c<sub>c</sub></em> = 504fF</td></tr></table>
         <table class="table">
           <tr align="center">
            <td width="130"></td>
            <td width="130">calculated</td>
            <td width="130">
             <em>SPICE OPUS</em></td></tr>
           <tr align="center">
            <td>
             <em>A<sub>u</sub></em>(<em>j<font face="symbol">w</font></em> = 0)</td>
            <td>74.2dB</td>
            <td>70.7dB</td></tr>
           <tr align="center">
            <td>
             <em>f</em><sub>-3dB</sub></td>
            <td>569Hz</td>
            <td>601Hz</td></tr></table></p>
        <p>Optimised CMOS operational amplifier has:
         <table>
          <tr>
           <td width="50"></td>
           <td width="400">
            <em>gain</em> = 70.7dB
            <br />
            <em>bandwidth</em> = 601Hz
            <br />
            <em>phase margin</em> = 51.3°
            <br />
            <em>peak to peak voltage</em> = 3.66V
            <br />
            <em>current consumption</em> = 
            43.8<font face="symbol">m</font>A
            <br />
            <em>area</em> =
            4407<font face="symbol">m</font>m<sup>2</sup></td></tr></table></p>
        <img border="0" src="./imgopt/opt006-07.gif" />
        <img border="0" src="./imgopt/opt006-08.gif" /></div></div></div></div>
    <!-- FOOTER -->
    <div class="footer">
     <p>
      <strong>Copyright &copy; 2008 Faculty of Electrical Engineering, Ljubljana, Slovenia | All Rights Reserved</strong></p>
     <p>Page Design
      <a href="mailto:gw@actamail.com">G. Wolfgang</a> | Page content
      <a href="mailto:spice_developers@fides.fe.uni-lj.si">EDA Group</a></p></div></div></div>
  <script type="text/javascript">
   var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
   document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script>
  <script type="text/javascript">
   try
   {
     var pageTracker = _gat._getTracker("UA-8305434-3");
     pageTracker._trackPageview();
   } catch(err)
   {
   }
  </script></body></html>

